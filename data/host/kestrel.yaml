---
nest::classes:
  - 'nest::host::kestrel'
  - 'nest::service::gitlab_runner'

nest::autologin: sway
nest::bird_role: server
nest::dvorak: true
nest::monitor_layout: ['DP-3@0', 'HDMI-A-1@2560']
nest::primary_monitor: 'HDMI-A-1'
nest::swap_alt_win: true
nest::text_scaling_factor: 1.1
nest::vpn_client: false

nest::dtb_overlay: |
  / {
    compatible = "milkv,pioneer", "sophgo,sg2042";

    /* Upstream PWM fan device with my cooling-levels */
    fragment@0 {
      target-path = "/";
      __overlay__ {
        pwmfan: pwm-fan {
          compatible = "pwm-fan";
          cooling-levels = <127 135 143 147 151>;
          pwms = <&pwm 0 40000 0>;
          #cooling-cells = <2>;
        };
      };
    };

    /* Cooling maps */
    fragment@1 {
      target-path = "/thermal-zones/soc-thermal";
      __overlay__ {
        cooling-maps {
          map0 {
            trip = <&soc_active1>;
            cooling-device = <&pwmfan 0 1>;
          };
          map1 {
            trip = <&soc_active2>;
            cooling-device = <&pwmfan 1 2>;
          };
          map2 {
            trip = <&soc_active3>;
            cooling-device = <&pwmfan 2 3>;
          };
          map3 {
            trip = <&soc_hot>;
            cooling-device = <&pwmfan 3 4>;
          };
        };
      };
    };

    fragment@2 {
      target-path = "/thermal-zones/board-thermal";
      __overlay__ {
        cooling-maps {
          map4 {
            trip = <&board_active>;
            cooling-device = <&pwmfan 3 4>;
          };
        };
      };
    };

    /* Hysteresis */
    fragment@3 {
      target-path = "/thermal-zones/soc-thermal/trips/soc-active1";
      __overlay__ {
        hysteresis = <2000>; /* mÂ°C */
      };
    };
    fragment@4 {
      target-path = "/thermal-zones/soc-thermal/trips/soc-active2";
      __overlay__ {
        hysteresis = <2000>;
      };
    };
    fragment@5 {
      target-path = "/thermal-zones/soc-thermal/trips/soc-active3";
      __overlay__ {
        hysteresis = <2000>;
      };
    };
    fragment@6 {
      target-path = "/thermal-zones/soc-thermal/trips/soc-hot";
      __overlay__ {
        hysteresis = <2000>;
      };
    };

    /* PCIe host ranges: expand 64-bit prefetchable to 12 GiB */
    fragment@7 {
      target-path = "/pcie@7060000000";
      __overlay__ {
        /* Help dtc validate 'ranges' in the overlay context */
        #address-cells = <3>;
        #size-cells = <2>;

        /* IO, 32-bit prefetchable, 32-bit non-prefetchable, 64-bit prefetchable (12 GiB) */
        ranges = <0x01000000 0x0  0xc0000000  0x40 0xc0000000  0x0 0x00400000>,
          <0x42000000 0x0  0xd0000000  0x40 0xd0000000  0x0 0x10000000>,
          <0x02000000 0x0  0xe0000000  0x40 0xe0000000  0x0 0x20000000>,
          <0x43000000 0x41 0x00000000  0x41 0x00000000  0x3 0x00000000>;
      };
    };
  };

nest::service::gitlab_runner::host: 'gitlab.james.tl'
nest::service::gitlab_runner::instances:
  builder:
    limit: 4
    bolt: true
    podman: true
    qemu: true

  chromium:
    bolt: true
    podman: true
    qemu: true

  ghc:
    bolt: true
    podman: true
    qemu: true
